stages:
  - validate
  - build

#cache:
#  paths:
#    - packer


validate:
  stage: validate
  environment:
    name: test
  script:
    - echo $AWS_ACCESS_KEY
    - echo $AWS_SECRET_KEY
    - echo $AWS_DEFAULT_REGION
    - echo $AWS_SOURCE_AMI
    - ls -l
    - packer --version
    - ansible --version
    - packer validate vsphere.pkr.hcl

build:
  stage: build
  environment:
    name: test
  tags:
    - local
  script:
    - pwd
    - packer build vsphere.pkr.hcl